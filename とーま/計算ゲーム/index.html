<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>計算ゲーム</title>
<style>
    body {
        min-height: 100vh;
        min-width: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        margin: 0;
        font-family: sans-serif;
    }

    #Time {
        margin: 10px;
        min-height: 1.5em; /* 高さを固定 */
    }

    #Goal {
        margin: 10px;
        min-height: 2em; /* 高さを固定 */
    }

    .Grid {
        display: grid;
        grid-template-rows: repeat(10, 35px);
        grid-template-columns: repeat(15, 50px);
        margin: 15px 0;
    }

    .cell { 
        box-sizing: border-box;
        outline: 1px solid black;
        background: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 25px;
        cursor: pointer;
    }

    button {
        width: 150px;
        height: 40px;
        margin: 10px;
        border: none;
        border-radius: 15px;
        background: #e0e0e0;
        color: black;
        font-size: 20px;
        font-weight: bold;
        box-shadow: 0 5px 0 #bbb;
        cursor: pointer;
        transition: 0.1s;
    }
    button:hover { box-shadow: 0 6px 0 #999; }
    button:active {
        position: relative;
        top: 4px;
        box-shadow: 0 2px 0 #999;
    }
    button:disabled { cursor: not-allowed; }

    .selected { background: darkorange; }
    .corect   { background: lightgreen; pointer-events: none; }
    .incorrect{ background: lightcoral; pointer-events: none; }

    /* メッセージ類の高さを固定 */
    #Pair, #Result {
        margin: 5px;
        min-height: 1.5em;
    }
</style>
</head>
<body>
    <h1 id="Time">残り：120秒</h1>
    <button id="Start">スタート</button>
    <h3 id="Goal">たて・よこに隣り合う数字をクリックして、足して10になるペアを見つけよう！</h3>
    <div id="Grid" class="Grid"></div>
    <h3 id="Pair">0組発見!!</h3>
    <h2 id="Result">&nbsp;</h2> <!-- 空白で高さ確保 -->
    <button id="End" disabled>終了</button>
</body>

<script>
const rows = 10;
const cols = 15;
let selectedCell = null;
let foundPairs = 0;
let missPairs = 0;
let timer = 120;
let timerId = null;
let isPlaying = false;

const grid = document.getElementById("Grid");
const start = document.getElementById("Start");
const end = document.getElementById("End");
const pair = document.getElementById("Pair");
const time = document.getElementById("Time");
const result = document.getElementById("Result");

function makeGrid() {
    grid.innerHTML = "";

    for(let r=0; r<rows; r++){
        for(let c=0; c<cols; c++){
            const cell = document.createElement("div");
            cell.className = "cell";
            cell.dataset.row = r;
            cell.dataset.col = c;
            grid.appendChild(cell);

            cell.addEventListener("click", () => onClickCell(cell));
        }
    }
    document.querySelectorAll(".cell").forEach(cell => cell.style.pointerEvents = "none");
}

function onClickCell(cell){
    if(cell.classList.contains("selected") || cell.classList.contains("corect")) {
        cell.classList.remove("selected");
        selectedCell = null;
        return;
    }

    if(!selectedCell){
        cell.classList.add("selected");
        selectedCell = cell;
    } else {
        const first = selectedCell;
        const second = cell;

        const firstNum = parseInt(first.textContent);
        const secondNum = parseInt(second.textContent);

        const r1 = parseInt(first.dataset.row);
        const c1 = parseInt(first.dataset.col);
        const r2 = parseInt(second.dataset.row);
        const c2 = parseInt(second.dataset.col);

        const isAdjacent = (Math.abs(r1 - r2) === 1 && c1 === c2) || (Math.abs(c1 - c2) === 1 && r1 === r2);

        if(firstNum + secondNum === 10 && isAdjacent){
            first.classList.remove("selected");
            second.classList.remove("selected");
            first.classList.add("corect");
            second.classList.add("corect");
            foundPairs++;
            pair.textContent = foundPairs + "組発見!!";
        } else {
            first.classList.remove("selected");
            second.classList.remove("selected");
        }
        selectedCell = null;
    }
}

function GameStart(){
    if(isPlaying) return;
    isPlaying = true;
    start.disabled = true;
    end.disabled = false;
    start.innerText = "挑戦中...";
    foundPairs = 0;
    pair.textContent = "0組発見!!";
    timer = 120;
    time.textContent = `残り：${timer}秒`;

    result.textContent = "\u00A0"; // 空白で高さ確保
    missPairs = 0;

    document.querySelectorAll(".cell").forEach(cell => {
        cell.textContent = Math.floor(Math.random() * 9) + 1;
        cell.classList.remove("selected", "corect","incorrect");
        cell.style.pointerEvents = "auto";
    });

    timerId = setInterval(() => {
        timer--;
        time.textContent = `残り：${timer}秒`;
        if(timer <= 0){
            clearInterval(timerId);
            answer();
            document.querySelectorAll(".cell").forEach(cell => cell.style.pointerEvents = "none");
            start.innerText = "再挑戦";
            start.disabled = false;
            isPlaying = false;
            result.textContent = `${missPairs}組発見できませんでした`;
        }
    }, 1000);
}

function answer() {
    const cells = Array.from(document.querySelectorAll(".cell"));
    for(let i = 0; i < cells.length; i++){
        const first = cells[i];
        if(first.classList.contains("corect") || first.classList.contains("incorrect")) continue;

        for(let j = i+1; j < cells.length; j++){
            const second = cells[j];
            if(second.classList.contains("corect") || second.classList.contains("incorrect")) continue;

            const r1 = parseInt(first.dataset.row);
            const c1 = parseInt(first.dataset.col);
            const r2 = parseInt(second.dataset.row);
            const c2 = parseInt(second.dataset.col);

            const isAdjacent = (Math.abs(r1 - r2) === 1 && c1 === c2) || (Math.abs(c1 - c2) === 1 && r1 === r2);

            const firstNum = parseInt(first.textContent);
            const secondNum = parseInt(second.textContent);

            if(firstNum + secondNum === 10 && isAdjacent){
                first.classList.add("incorrect");
                second.classList.add("incorrect");
                missPairs++;
                break;
            }
        }
    }
}

function GameEnd() {
    clearInterval(timerId);
    answer();
    document.querySelectorAll(".cell").forEach(cell => cell.style.pointerEvents = "none");
    start.innerText = "再挑戦";
    start.disabled = false;
    end.disabled = true;
    isPlaying = false;
    result.textContent = `${missPairs}組発見できませんでした`;
}

function RestGame() {
    clearInterval(timerId);
    timer=120;
    time.textContent=`残り：${timer}秒`;

    document.querySelectorAll(".cell").forEach(cell => {
        cell.textContent="";
        cell.classList.remove("selected","corect","incorrect");
        cell.style.pointerEvents="none";
    })

    foundPairs=0;
    missPairs=0;
    pair.textContent="0組発見!!";
    result.textContent="\u00A0";

    start.disabled=false;
    start.innerText="スタート";
    end.disabled=true;

    selectedCell=null;
    isPlaying=false;
}

makeGrid();

start.addEventListener("click", () => {
    if(start.innerText === "スタート"){
        GameStart(); // ゲーム開始
    } else {
        RestGame();  // 再挑戦押したときはリセットのみ
    }
});
end.addEventListener("click", GameEnd);
</script>
</html>
